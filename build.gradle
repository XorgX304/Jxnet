
allprojects {
	
	apply plugin: 'java'

	group = 'com.ardikars.jxnet'
	version = '1.1.1-SHAPSHOT'

	sourceCompatibility = 1.8
	targetCompatibility = 1.8

	[compileJava, compileTestJava]*.options*.encoding = 'UTF-8'

	repositories {
		mavenCentral()
	}

}

apply from: 'config.gradle'

subprojects.each {
	subproject -> evaluationDependsOn(subproject.path)
}

jar.dependsOn subprojects.tasks['classes']

clean {
	file("${rootDir}/obj").deleteDir()
	file("${rootDir}/jni/Makefile").delete()
	file("${rootDir}/jni/src/Makefile").delete()
	file("${rootDir}/jni/Makefile.in").delete()
	file("${rootDir}/jni/src/Makefile.in").delete()
	file("${rootDir}/jni/aclocal.m4").delete()
	file("${rootDir}/jni/compile").delete()
	file("${rootDir}/jni/config.guess").delete()
	file("${rootDir}/jni/config.log").delete()
	file("${rootDir}/jni/config.status").delete()
	file("${rootDir}/jni/configure").delete()
	file("${rootDir}/jni/depcomp").delete()
	file("${rootDir}/jni/install-sh").delete()
	file("${rootDir}/jni/libtool").delete()
	file("${rootDir}/jni/ltmain.sh").delete()
	file("${rootDir}/jni/missing").delete()
	file("${rootDir}/jni/config.sub").delete()
	file("${rootDir}/jni/autom4te.cache").deleteDir()
	file("${rootDir}/jni/.autotools").delete()
	file("${rootDir}/jni/jxnet-1.1.0.tar.gz").delete()
	file("${rootDir}/jni/src/.deps").deleteDir()
	file("${rootDir}/jni/src/.libs").deleteDir()
	delete fileTree("${rootDir}/jni/src") {
		include '**/*.o'
		include '**/*.lo'
		include '**/*.la'
	}
}

jar {
	subprojects.each { subproject ->
		from subproject.sourceSets.main.output.classesDir
		from subproject.sourceSets.main.output.resourcesDir
	}
}

task ndkBuild(type: Exec, dependsOn: ':jxnet-core:generateJNIHeaders') {
	commandLine "${NDK_HOME}/ndk-build", '-C', "${JXNET_DIR}",
			"NDK_LIBS_OUT=${JXNET_OUT}", "NDK_OUT=${JXNET_OBJ}"
}

task ndkClean(type: Exec) {
	commandLine "${NDK_HOME}/ndk-build", '-C', "${JXNET_DIR}", 'clean',
			"NDK_LIBS_OUT=${JXNET_OUT}", "NDK_OUT=${JXNET_OBJ}"
}

task ndkBuildTools(type: Exec) {
	commandLine "${NDK_HOME}/ndk-build", '-C', "${TOOLS_DIR}",
			"NDK_LIBS_OUT=${TOOLS_OUT}", "NDK_OUT=${TOOLS_OBJ}"
}

task ndkCleanTools(type: Exec) {
	commandLine "${NDK_HOME}/ndk-build", '-C', "${TOOLS_DIR}", 'clean',
			"NDK_LIBS_OUT=${TOOLS_OUT}", "NDK_OUT=${TOOLS_OBJ}"
}

